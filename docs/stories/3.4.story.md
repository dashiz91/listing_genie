# Story 3.4: Download All Images as ZIP

**Epic:** Epic 3 - Gallery & Download
**Story ID:** 3.4
**Title:** Download All Images as ZIP
**Priority:** Must Have
**Complexity:** Medium
**Status:** Draft

---

## User Story

As a user, I want to download all images at once as a ZIP file so that I can quickly get all my listing images.

---

## Acceptance Criteria

- [ ] "Download All" button prominently displayed
- [ ] ZIP file contains all 5 images
- [ ] Each image in ZIP has descriptive filename
- [ ] ZIP file named with product title or session ID
- [ ] Download progress indicator for ZIP creation
- [ ] ZIP generation happens server-side
- [ ] Download works on mobile devices

---

## Technical Notes

### API Endpoint
```
GET /api/download/{session_id}/zip
Response: application/zip binary

Headers:
- Content-Type: application/zip
- Content-Disposition: attachment; filename="listing_images_{session_id}.zip"
```

### ZIP Contents
```
listing_images_{session_id}.zip
|-- 1_main_image.png
|-- 2_infographic_1.png
|-- 3_infographic_2.png
|-- 4_lifestyle.png
|-- 5_comparison.png
```

### Server-Side ZIP Generation
```python
import zipfile
from io import BytesIO

def create_zip(session_id: str, storage: StorageService) -> BytesIO:
    zip_buffer = BytesIO()

    with zipfile.ZipFile(zip_buffer, 'w', zipfile.ZIP_DEFLATED) as zip_file:
        for i, image_type in enumerate(IMAGE_TYPES, 1):
            path = storage.get_image_path(session_id, image_type)
            filename = f"{i}_{image_type}.png"
            zip_file.write(path, filename)

    zip_buffer.seek(0)
    return zip_buffer
```

### UI Placement
- Primary CTA at top of gallery
- Large, green button with download icon
- "Download All as ZIP" label

### Progress Indicator
- Show spinner during ZIP creation
- "Preparing download..." message
- Transition to download automatically

---

## Dependencies

- **Depends On:** Story 3.1 (Gallery), Story 2.7 (Storage)
- **Required By:** None

---

## Definition of Done

- [ ] "Download All" button prominent in gallery
- [ ] ZIP contains all 5 images
- [ ] Images have numbered, descriptive filenames
- [ ] ZIP filename includes session identifier
- [ ] Progress indicator during creation
- [ ] Server-side ZIP generation works
- [ ] Download triggers automatically after creation
- [ ] Works on desktop browsers
- [ ] Works on mobile browsers
