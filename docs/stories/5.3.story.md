# Story 5.3: Set Up Database for Persistence

**Epic:** Epic 5 - Core Infrastructure
**Story ID:** 5.3
**Title:** Set Up Database for Persistence
**Priority:** Must Have
**Complexity:** Medium
**Status:** Draft

---

## User Story

As the system, I need a database to store generation sessions, keywords, and image metadata.

---

## Acceptance Criteria

- [ ] SQLite database configured for MVP
- [ ] ORM setup (SQLAlchemy) with models
- [ ] GenerationSession model (id, status, created_at, etc.)
- [ ] SessionKeyword model (keyword, intent_type, session_id, etc.)
- [ ] ImageRecord model (type, url, session_id, etc.)
- [ ] Database migrations support (Alembic optional for MVP)
- [ ] Connection pooling configured

---

## Technical Notes

### Database Schema Reference
See `docs/architecture.md` Section 4 for complete schema.

### Key Models

**GenerationSession:**
- id (PK, UUID)
- status (pending/processing/complete/partial/failed)
- upload_path
- product_title, feature_1, feature_2, feature_3, target_audience
- created_at, completed_at, expires_at

**SessionKeyword:**
- id (PK)
- session_id (FK)
- keyword
- intent_types (JSON array)
- created_at

**ImageRecord:**
- id (PK)
- session_id (FK)
- image_type (main/infographic_1/infographic_2/lifestyle/comparison)
- storage_path
- status
- error_message
- retry_count
- created_at, completed_at

### Database URL Configuration
```
# SQLite for MVP
DATABASE_URL=sqlite:///./listing_genie.db

# PostgreSQL for production
DATABASE_URL=postgresql://user:password@host:5432/listing_genie
```

---

## Dependencies

- **Depends On:** Story 5.1 (FastAPI Backend Setup)
- **Required By:** Story 2.1, Story 2.7, Story 4.2

---

## Definition of Done

- [ ] SQLAlchemy models created and validated
- [ ] Database tables created successfully
- [ ] CRUD operations work for all models
- [ ] Session management handles connections properly
- [ ] Database can be queried from API endpoints
- [ ] Connection pooling prevents connection exhaustion
